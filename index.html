<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">

    <title>Skrzeszewski Pingiel</title>
    <script src="/socket.io.js"></script>
    <script src="/jquery.min.js"></script>
    <script src="/jquery-ui.min.js"></script>
    <script src="/knockout-2.2.1.js"></script>
    <script src="/sevenSeg.js"></script>


    <link rel="stylesheet" href="/bootstrap.min.css" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>
<body class="bg-black">

    <div class="container">
        <div class="row">
            <h1 style="text-align: center">Skrzeszewski Pingiel</h1>
        </div>
        <div class="row">

            <!--<div class="col-md-12 ">-->
            <!--<p style="text-align: center"><button id='btn_click' class="bnt btn-lg btn-success">Click Me!</button></p>

        <p style="text-align: center">Click counts:<span id="counter"></span></p>-->
            <div class="col text-center"><div id="counter1"></div></div>
            <div class="col text-center"><h1>Game points</h1></div>
            <div class="col text-center"><div id="counter2"></div></div>
        </div>
        <div class="row">
            <div class="col"><div style="height:150px; margin-top: 50px" id="matchCounter1"></div></div>
            <div class="col "><h1 style="padding-left:100px;">Match points</h1></div>
            <div class="col"><div style="height: 150px; margin-top: 50px" id="matchCounter2"></div></div>
        </div>
        <div class="row" style="padding-top: 50px">
            <div class="col-sm text-center"><img id="serve1" src="/1r.png" /></div>
            <div class="col text-center"><button id='btn_click' class="btn btn-primary">Reset</button></div>
            <div class="col-sm text-center"><img id="serve2"src="/1r.png" /></div>
        </div>
        <!-- </div>-->
    </div>


    <script>
        const soundEffect = new Audio();
        soundEffect.autoplay = true;
        var servechange = 0;;
    $(function () {

        var socket = io();//connect to the socket
        
        socket.on('connect',function()
        {
           console.log('Yeah I am connected!!');
        });

        //Listen from server.js
        socket.on('click_count',function(value)
        {
            $('#counter').html(value);//Set new count value
        });

        socket.on('p1_count', function (value) {
            pointsound();
            $('#counter1').sevenSegArray({
                digits: 2, value: value, segmentOptions: {
                    colorOff: "#121010",
                    colorOn: "Red"
                } });//html(value);//Set new count value
            $('.container').effect("highlight", {}, 200);
        });
        socket.on('p2_count', function (value) {
            pointsound();
            $('#counter2').sevenSegArray({
                digits: 2, value: value, segmentOptions: {
                    colorOff: "#121010",
                    colorOn: "Red"
                }
});//html(value);//Set new count value
            $('.container').effect("highlight", {}, 200);
        });

        socket.on('p1_match', function (value) {
            matchpointsound();
            $('#matchCounter1').sevenSegArray({
                digits: 1, value: value, segmentOptions: {
                    colorOff: "#003200",
                    colorOn: "Lime"
                } });//html(value);//Set new count value
        });

        socket.on('p2_match', function (value) {
            matchpointsound();
            $('#matchCounter2').sevenSegArray({
                digits: 1, value: value, segmentOptions: {
                    colorOff: "#003200",
                    colorOn: "Lime"
                } });// html(value);//Set new count value
        });

        socket.on('serve', function (value) {
            if (value.p == 1) {
                if (value.s == 1) {
                    $('#serve1').attr('src', '1r.png');
                } else {
                    $('#serve1').attr('src', '2r.png');
                }
                $('#serve1').show();
                $('#serve2').hide();
            }
            else {
                if (value.s == 1) {
                    $('#serve2').attr('src', '1r.png');
                } else {
                    $('#serve2').attr('src', '2r.png');
                }
                $('#serve2').show();
                $('#serve1').hide();
            }

        });

        socket.on('p1_turn', function (value) {
            servechange = 2;
        });
        socket.on('p2_turn', function (value) {
            servechange = 2;
        });

        //Says to server that the button has been clicked
        $('#btn_click').click(function()
        {
            socket.emit('clicked');//Emitting user click
        });

    });
        function playsound(sound) {
            var playPromise = sound.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    // Automatic playback started!
                    // Show playing UI.
                })
                    .catch(error => {
                        // Auto-play was prevented
                        // Show paused UI.
                    });
            }
        }
        function pointsound() {

            if (servechange > 0) {
                soundservechange();
                servechange -= 1;
            } else {
                //soundEffect.src = "data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";

                //// later on when you actually want to play a sound at any point without user interaction
                soundEffect.src = '/sounds/point.mp3';
                //soundEffect.play();
                playsound(soundEffect);
            }
            
        }
        function matchpointsound() {
            soundEffect.src = '/sounds/setwin.mp3';
            //soundEffect.play();
            playsound(soundEffect);
        }
        function soundservechange() {
            soundEffect.src = '/sounds/serve.mp3';
            //soundEffect.play();
            playsound(soundEffect);
        }
    </script>
</body>
</html>